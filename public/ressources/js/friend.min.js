const textRound=document.getElementById("script").getAttribute("textRound"),textPoints=document.getElementById("script").getAttribute("textPoints"),textConnection=document.getElementById("script").getAttribute("textConnection"),textPlayer=document.getElementById("script").getAttribute("textPlayer"),textLeft=document.getElementById("script").getAttribute("textLeft");function window_resize(){if(window.innerWidth<1e3){document.getElementById("main_container").innerHTML="Unsupported device.";return}var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById("main_container").innerHTML=this.responseText)},a.open("GET","/ressources/game/board/1000.min.html",!0),a.send()}var latencyBegin,savedUsedDices,selected_dice,addEvent=function(a,b,c){null!=a&& void 0!==a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c)};function inArray(c,b){for(var d=b.length,a=0;a<d;a++)if(b[a]==c)return!0;return!1}addEvent(window,"resize",window_resize),window_resize();var activePlayer=!1,board=[],dices=[],diceWhite=0,diceBlue=0,eventGame="game",socket=new WebSocket("wss://clever.mexenus.com:8080");function latencyResponse(){ping=(response=Math.round(window.performance.now()))-latencyBegin,document.getElementById("ping").innerHTML=ping}function latencySend(){latencyBegin=Math.round(window.performance.now()),socket.send('"latency"')}socket.onmessage=function(a){return(message=JSON.parse(a.data),console.log(message),"latency"===message)?latencyResponse():void 0!==message.exit?exitGame(message.exit):void 0!==message.message?newMessage(message.message):(void 0!==message.player&&newPlayer(message.player),void 0!==message.bonus&&bonus(message.bonus),void 0!==message.board&&(board=message.board,make_board()),void 0!==message.dice&&setDice(message.dice),void 0!==message.used_dices&&setUsedDices(message.used_dices),void 0!==message.last_phase&&(message.last_phase?(replay(!1),plus(!0),newPlayer(!0),setTimeout(setUsedDices(),50)):(replay(!0),plus(!1))),void 0!==message.round)?new_round(message.round):void(void 0!==message.finish&&finish(message.finish))},socket.onclose=function(){alert(textConnection),window.location.replace("/pregame/friend")},socket.onerror=function(b){var a=new XMLHttpRequest;a.open("GET","/call/game/socket.error.php?q="+encodeURI(JSON.stringify(b, ["message", "arguments", "type", "name"])),!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.send()};var countUnread=0,navOpenClosed=!1;function openNav(){navOpenClosed=!0,e=document.getElementById("mySidebar"),document.getElementById("undermySidebar").style.display="block",e.style.display="block",document.getElementById("img-message").innerHTML='<img src="/ressources/img/chat.svg">',countUnread=0,setTimeout(function(){e.classList.remove("animate__fadeInLeft"),e.classList.remove("animate__animated"),(obj=document.getElementById("mySidebar")).scrollTop=obj.scrollHeight},500)}function closeNav(){navOpenClosed=!1,(e=document.getElementById("mySidebar")).classList.add("animate__animated"),e.classList.add("animate__fadeOutLeft"),setTimeout(function(){document.getElementById("undermySidebar").style.display="none",e.style.display="none",e.offsetWidth,e.classList.add("animate__fadeInLeft"),e.classList.remove("animate__fadeOutLeft")},500)}function exitGame(a){socket.onclose=function(){},socket.close(),alert(textLeft.replace("-{player}-",a)),window.location.replace("/pregame/friend")}function sendMessage(){return message=document.getElementById("message").value,document.getElementById("message").value="",document.getElementById("all-message").innerHTML+="<p><strong>You:&nbsp;</strong>"+message+"<br/></p>",obj=document.getElementById("mySidebar"),obj.scrollTop=obj.scrollHeight,send={message:message},socket.send(JSON.stringify(send)),!1}function newMessage(a){document.getElementById("all-message").innerHTML+="<p><strong>"+a.sender+":&nbsp;</strong>"+a.text+"<br/></p>",(obj=document.getElementById("mySidebar")).scrollTop=obj.scrollHeight,navOpenClosed||(countUnread++,(e=document.getElementById("img-message")).innerHTML='<span class="badge bg-danger px-2">'+countUnread+"</span>",e.classList.remove("animate__tada"),e.offsetWidth,e.classList.add("animate__tada"))}function newPlayer(a){for(i=0;i<3;)i++,document.getElementById(i+"-dice-div").style.display="none";if("boolean"==typeof a){document.getElementById("myModal_player").style.display="none",document.getElementById("text_player").innerHTML="",activePlayer=!0;return}activePlayer=!1,document.getElementById("myModal_player").style.display="block",document.getElementById("text_player").innerHTML=textPlayer.replace("-{player}-",a)}function finish(a){socket.onclose=function(){},socket.close(),document.getElementById("myModal_end").style.display="block",document.getElementById("text_score").innerHTML=textPoints.replace("-{points}-",a.total),setTimeout(function(){window.location.replace("/result/friend")},1e4)}function new_round(a){for(document.getElementById("myModal_round").style.display="block",document.getElementById("text_round").innerHTML=textRound.replace("-{round}-",a),document.getElementById("b-text-round").innerHTML=textRound.replace("-{round}-",a),document.getElementById("myModal").style.opacity=0,i=0;i<3;)i++,document.getElementById(i+"-dice-div").style.display="none";setTimeout(function(){document.getElementById("myModal_round").style.display="none",document.getElementById("myModal").style.opacity=1},3e3)}const diceColors=["blue","yellow","green","orange","purple","white"],diceColorCode=["#3284b8","#dbc900","#6bb058","#dba100","#8835cc","#ffffff"];function setUsedDices(a=!1){for(x in!1===a?a=savedUsedDices:savedUsedDices=a,i=0,a)i++,index_color=diceColors.indexOf(x),document.getElementById(i+"-dice-div").style.backgroundColor=diceColorCode[index_color],document.getElementById(i+"-dice-div").style.display="inline-block",document.getElementById(i+"-dice-text").innerHTML=a[x],"white"===x?document.getElementById(i+"-dice-div").style.color="#000000":document.getElementById(i+"-dice-div").style.color="#ffffff";if(3!=i)for(;i<3;)i++,document.getElementById(i+"-dice-div").style.display="none"}async function setDice(a){if(!1===activePlayer)for(x in dices)hideDice(x);for(x in dices=a,diceColors)(div=document.getElementById(diceColors[x]+"-dice-div")).classList.remove("animate__rollIn"),void 0!==a[diceColors[x]]&&((text=document.getElementById(diceColors[x]+"-dice-text")).innerHTML=a[diceColors[x]],div.offsetWidth,div.setAttribute("draggable",!0),div.style.visibility="visible",div.style.cursor="grab",div.style.opacity=1,div.classList.add("animate__rollIn"),"blue"===diceColors[x]&&(diceBlue=a[diceColors[x]]),"white"===diceColors[x]&&(diceWhite=a[diceColors[x]]))}function hideDice(a){document.getElementById(a+"-dice-div").style.visibility="hidden"}async function make_board(){makeBoardBlue(board.blue),makeBoardYellow(board.yellow),makeBoardGreen(board.green),makeBoardOrange(board.orange),makeBoardPurple(board.purple),makePlusOne(board.p1),makeReplay(board.re)}function makeBoardBlue(a){for(x in a)(text=document.getElementById("b-"+x+"-text")).style.color="#3284b8",text.style.fontFamily="system-ui",text.innerHTML=x,a[x]&&(text.style.color="#000000",text.style.fontFamily="PermanentMarker",text.innerHTML="X")}function makeBoardYellow(a){for(x in a)(text=document.getElementById("y-"+x+"-text")).style.fontFamily="system-ui",text.innerHTML=x.charAt(1),a[x]&&(text.style.fontFamily="PermanentMarker",text.innerHTML="X")}const numbers_green=[1,2,3,4,5,6,7,8,9,10,11],text_green=["\u22651","\u22652","\u22653","\u22654","\u22655","\u22651","\u22652","\u22653","\u22654","\u22655","\u22656"];function makeBoardGreen(a){for(x in numbers_green)(text=document.getElementById("g-"+numbers_green[x]+"-text")).style.color="#6bb058",text.style.fontFamily="system-ui",text.innerHTML=text_green[x],numbers_green[x]>a||(text.style.color="#000000",text.style.fontFamily="PermanentMarker",text.innerHTML="X")}function makeBoardOrange(a){for(x in a)(text=document.getElementById("o-"+x+"-text")).style.color="#dba100",text.style.fontFamily="system-ui",inArray(x,[4,7,9,11])?11==x?text.innerHTML="x3":text.innerHTML="x2":text.innerHTML="&nbsp;",0!=a[x]&&(text.style.color="#000000",text.style.fontFamily="PermanentMarker",text.innerHTML=a[x])}function makeBoardPurple(a){for(x in a)(text=document.getElementById("p-"+x+"-text")).style.color="#a442f5",text.style.fontFamily="system-ui",tmp_index=x-1,1==x||6==document.getElementById("p-"+tmp_index+"-text").innerHTML?text.innerHTML="&nbsp;":text.innerHTML="<",0!=a[x]&&(text.style.color="#000000",text.style.fontFamily="PermanentMarker",text.innerHTML=a[x])}function makePlusOne(a){document.getElementById("plus_one_count").innerHTML=a}function makeReplay(a){document.getElementById("replay_count").innerHTML=a}async function bonus(a){let b=document.getElementById("modal_img");for(x in b.innerHTML="",a)if(b.innerHTML+='<img class="m-3" src="/ressources/game/bonus-'+a[x]+'.png" width="100" height="auto">',inArray(a[x],[2,8,13,14]))return document.getElementById("myModal").style.display="block",bonusChoice(a[x]);document.getElementById("myModal").style.display="block"}var bonusChoiceID=0;function bonusChoice(a){switch(bonusChoiceID=a,eventGame="bonus",a){case 2:dice={yellow:"X"};break;case 8:dice={blue:"X"};break;case 13:dice={white:"X"};break;case 14:dice={white:6}}setDice(dice)}async function plus(a){div=document.getElementById("plus_one"),board.p1>0&&a&&"bonus"!==eventGame?(div.style.opacity=1,div.style.cursor="pointer"):(div.style.opacity=.6,div.style.cursor="not-allowed")}async function replay(a){div=document.getElementById("replay"),board.re>0&&a&&"bonus"!==eventGame?(div.style.opacity=1,div.style.cursor="pointer"):(div.style.opacity=.6,div.style.cursor="not-allowed")}function reply_click(a){if(1!=(div=document.getElementById(a)).style.opacity)return!1;"replay"===a&&socket.send('{"bonus":"replay"}'),"plus_one"===a&&(socket.send('{"bonus":"plus1"}'),eventGame="plus1")}function getDiceColor(a){switch(a){case"b":return"blue";case"y":return"yellow";case"g":return"green";case"o":return"orange";case"p":return"purple"}}var possible_values=[];function reply_drop(b,a){switch(eventGame){case"game":send={choice:{position:a.split("-")[1],color:getDiceColor(a.split("-")[0]),dice:selected_dice}};break;case"plus1":send={p1_choice:{position:a.split("-")[1],color:getDiceColor(a.split("-")[0]),dice:selected_dice}},eventGame="game";break;case"bonus":send={bonus_choice:{position:a.split("-")[1],color:getDiceColor(a.split("-")[0]),id:bonusChoiceID}},eventGame="game"}for(x in socket.send(JSON.stringify(send)),dices)hideDice(x)}function reply_dragstart(b,a){if("bonus"===eventGame)return replay_dragstartBonus(b,a);if(void 0===dices[selected_dice=a.split("-")[0]])return!1;switch(selected_dice){case"blue":board.blue[dices.blue+diceWhite]||possible_values.push("b-"+(dices.blue+diceWhite)+"-div");break;case"yellow":board.yellow[dices.yellow+10]||possible_values.push("y-"+(dices.yellow+10)+"-div"),board.yellow[dices.yellow+20]||possible_values.push("y-"+(dices.yellow+20)+"-div");break;case"green":green_value=board.green>=5?board.green-5:board.green,dices.green>=green_value&&11!=board.green&&possible_values.push("g-"+(board.green+1)+"-div");break;case"orange":11!=board.orange_position&&possible_values.push("o-"+(board.orange_position+1)+"-div");break;case"purple":board.last_purple_value<dices.purple&&11!=board.purple_position&&possible_values.push("p-"+(board.purple_position+1)+"-div");break;default:board.blue[diceBlue+dices.white]||possible_values.push("b-"+(diceBlue+dices.white)+"-div"),board.yellow[dices.white+10]||possible_values.push("y-"+(dices.white+10)+"-div"),board.yellow[dices.white+20]||possible_values.push("y-"+(dices.white+20)+"-div"),green_value=board.green>=5?board.green-5:board.green,dices.white>=green_value&&11!=board.green&&possible_values.push("g-"+(board.green+1)+"-div"),11!=board.orange_position&&possible_values.push("o-"+(board.orange_position+1)+"-div"),board.last_purple_value<dices.white&&11!=board.purple_position&&possible_values.push("p-"+(board.purple_position+1)+"-div")}}function replay_dragstartBonus(a,b){switch(bonusChoiceID){case 2:for(x in board.yellow)board.yellow[x]||possible_values.push("y-"+x+"-div");break;case 8:for(x in board.blue)board.blue[x]||possible_values.push("b-"+x+"-div");break;case 13:for(x in board.yellow)board.yellow[x]||possible_values.push("y-"+x+"-div");for(x in board.blue)board.blue[x]||possible_values.push("b-"+x+"-div");11!=board.green&&possible_values.push("g-"+(board.green+1)+"-div");break;case 14:11!=board.orange_position&&possible_values.push("o-"+(board.orange_position+1)+"-div"),11!=board.purple_position&&possible_values.push("p-"+(board.purple_position+1)+"-div")}}function allowDrop(a,b){inArray(b,possible_values)&&a.preventDefault()}setInterval(latencySend,2500)